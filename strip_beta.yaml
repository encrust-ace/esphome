esphome:
  name: strip-beta
  friendly_name: "Strip Beta"

esp8266:
  board: nodemcuv2
  restore_from_flash: true

logger:
api:
ota:
  - platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "Strip-Beta Fallback Hotspot"
    password: "12345678"

captive_portal:
web_server:
improv_serial:
wled:

# ========== SENSORS ==========
sensor:
  # WiFi Signal Strength
  - platform: wifi_signal
    name: "WiFi Signal"
    id: wifi_signal_db
    update_interval: 60s
    entity_category: "diagnostic"

  # Uptime in seconds
  - platform: uptime
    name: "Uptime"
    unit_of_measurement: "s"
    entity_category: "diagnostic"

  # Free Heap (RAM)
  - platform: template
    name: "Free Heap"
    lambda: 'return (float)ESP.getFreeHeap();'
    unit_of_measurement: "bytes"
    update_interval: 60s
    entity_category: "diagnostic"

  # ESP Internal Temperature (supported on ESP8266)
  # - platform: internal_temperature
  #   name: "ESP Temperature"
  #   entity_category: "diagnostic"

# ========== TEXT SENSORS ==========
text_sensor:
  # WiFi Info
  - platform: wifi_info
    ip_address:
      name: "IP Address"
      icon: "mdi:ip-network"
      entity_category: "diagnostic"
    ssid:
      name: "Connected SSID"
      icon: "mdi:wifi"
      entity_category: "diagnostic"
    bssid:
      name: "BSSID"
      icon: "mdi:router-wireless"
      entity_category: "diagnostic"
    mac_address:
      name: "MAC Address"
      icon: "mdi:ethernet"
      entity_category: "diagnostic"

# ========== LIGHT ==========
light:
  - platform: neopixelbus
    type: GRB
    variant: WS2812X
    pin: GPIO02
    num_leds: 60
    id: strip_light
    name: "Light"
    restore_mode: RESTORE_DEFAULT_OFF
    effects:
      - random:
      - random:
          name: "Random Fast"
          transition_length: 4s
          update_interval: 5s
      - pulse:
      - addressable_flicker:
      - addressable_fireworks:
      - addressable_twinkle:
      - addressable_random_twinkle:
      - addressable_scan:
      - addressable_color_wipe:
      - addressable_rainbow:
          name: "Rainbow"
      - addressable_rainbow:
          name: "Slow Rainbow"
          speed: 5
      - addressable_lambda:
          name: "Diya Flicker"
          update_interval: 16ms
          lambda: |-
            float animation_period_ms = 10000.0;
            float time_progress = fmod((float)millis(), animation_period_ms) / animation_period_ms;
            float time_phase = time_progress * M_PI * 2.0;

            Color base_flame_color = Color(255, 100, 0);
            Color peak_flame_color = Color(255, 255, 200);

            int base_glow_leds = 3;

            float global_flicker_speed = 4.0;
            float per_led_flicker_speed = 8.0;
            float min_brightness_factor = 0.3;
            float max_brightness_factor = 1.0;
            float random_flicker_strength = 0.2;

            float global_flicker = (sin(time_phase * global_flicker_speed) + 1.0f) / 2.0f;

            auto blend = [](uint8_t a, uint8_t b, float t) -> uint8_t {
              return static_cast<uint8_t>(a + (b - a) * t);
            };

            for (int i = 0; i < it.size(); i++) {
              Color current_led_color;
              float current_brightness_factor;

              if (i < base_glow_leds) {
                current_led_color = base_flame_color;
                current_brightness_factor = 1.0;
              } else {
                float per_led_flicker = (sin(time_phase * per_led_flicker_speed + i * 0.5f) + 1.0f) / 2.0f;
                float combined_flicker = global_flicker * 0.7f + per_led_flicker * 0.3f;

                float random_val = (float)esphome::random_uint32() / (float)UINT32_MAX;
                combined_flicker += (random_val - 0.5f) * random_flicker_strength;
                combined_flicker = esphome::clamp(combined_flicker, 0.0f, 1.0f);

                current_brightness_factor = min_brightness_factor + 
                  (max_brightness_factor - min_brightness_factor) * combined_flicker;

                float height_progress = (float)(i - base_glow_leds) / (it.size() - 1.0f - base_glow_leds);
                height_progress = esphome::clamp(height_progress, 0.0f, 1.0f);

                current_led_color = Color(
                  blend(base_flame_color.r, peak_flame_color.r, height_progress),
                  blend(base_flame_color.g, peak_flame_color.g, height_progress),
                  blend(base_flame_color.b, peak_flame_color.b, height_progress)
                );
              }

              it[i] = Color(
                static_cast<uint8_t>(current_led_color.r * current_brightness_factor),
                static_cast<uint8_t>(current_led_color.g * current_brightness_factor),
                static_cast<uint8_t>(current_led_color.b * current_brightness_factor)
              );
            }

      - wled:
          name: "UDP Sync"
